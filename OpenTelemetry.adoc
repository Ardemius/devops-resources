= Pr√©sentation d'OpenTelemetry
Thomas SCHWENDER <icon:github[] https://github.com/Ardemius/[GitHub] / icon:twitter[role="aqua"] https://twitter.com/thomasschwender[@thomasschwender]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: ./images
:resourcesdir: ./resources
:source-highlighter: highlightjs
:highlightjs-languages: asciidoc
// We must enable experimental attribute to display Keyboard, button, and menu macros
:experimental:
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
:toclevels: 4
// To number the sections of the table of contents
//:sectnums:
// Add an anchor with hyperlink before the section title
:sectanchors:
// To turn off figure caption labels and numbers
:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions
// :caption:

toc::[]

== Pr√©sentation g√©n√©rale de la solution et objectifs

* Projet opensource dont l'objectif est de fournir une *solution unifi√©e* pour la *collecte* et l'*exportation de donn√©es d'observabilit√© / t√©l√©m√©trie* (m√©triques, logs, traces) pour tout type d'application (on-premises ou Cloud)

* Il offre une *API unifi√©e*, impl√©ment√©e par *diff√©rents SDK* (pour Java, Python, Go, etc.), permettant d'instrumenter les applications de mani√®re standardis√©e, quelle que soit la technologie utilis√©e.
* Si l'on souhaite √©viter une modification du code source, des *agents OpenTelemetry* peuvent √™tre install√©s afin de collecter les donn√©es de t√©l√©m√©trie.
* Des *collectors OpenTelemetry* existent √©galement pour recevoir les donn√©es de t√©l√©m√©trie envoy√©es par les agents et / ou applications utilisant les SDKs.

.Observabilit√© et t√©l√©m√©trie
====
* *Observabilit√©* : L'observabilit√© est la capacit√© √† d√©duire le fonctionnement interne d'un syst√®me √† partir de ses sorties externes. 

* *T√©l√©m√©trie* : Le processus automatis√© de collecte et de transmission de donn√©es √† partir de sources distantes vers un emplacement central √† des fins d'analyse et de surveillance.
====

TIP: OpenTelemetry ou "OTel" de son petit nom üòâ

== Principaux avantages d'OpenTelemetry

* *Unification des donn√©es* : OpenTelemetry permet de collecter diff√©rents types de donn√©es de t√©l√©m√©trie (m√©triques, logs, traces) dans un *format standardis√©*, facilitant ainsi l'analyse et la corr√©lation.

* *Vendor-neutral* : Les donn√©es collect√©es par OpenTelemetry peuvent √™tre export√©es vers diff√©rents backends d'observabilit√© (Splunk, New Relic, Dynatrace, etc.), offrant une grande flexibilit√©.

* *Communaut√© active* : OpenTelemetry est un projet tr√®s populaire qui est en train de devenir un standard en mati√®re d'observabilit√©. +
De nombreux √©diteurs ont d√©velopp√© des connecteurs pour aller r√©cup√©rer les donn√©es r√©cup√©r√©es par les connectors OpenTelemetry.

== Architecture d'OpenTelemetry

Les principaux composants de la plateforme OpenTelemetry : 

    * *Agent* (on parlera aussi d'*auto-instrumentation*) : Collecte automatiquement les donn√©es au niveau de l'application, sans besoin de modifier le code source de l'application
        ** Son r√¥le principal est d'instrumenter l'application et d'envoyer les donn√©es de t√©l√©m√©trie √† un point de collecte, g√©n√©ralement un collector.
        ** Pour un exemple d'agent, voici celui de Java : https://github.com/open-telemetry/opentelemetry-java-instrumentation +
        "This project provides a Java agent JAR that can be attached to any Java 8+ application and dynamically injects bytecode to capture telemetry from a number of popular libraries and frameworks"

    * *Collector* : Re√ßoit, traite et exporte les donn√©es
        ** Il est le point central de collecte des donn√©es de t√©l√©m√©trie. Il re√ßoit les donn√©es des agents et peut les exporter vers diff√©rents backends.
        ** un collector est compos√© lui-m√™me de 3 composants : 
            *** *Receiver* : point d'entr√©e des donn√©es de t√©l√©m√©trie dans le Collector. +
            Il re√ßoit les donn√©es provenant des diff√©rents agents ou sources et les met dans un format standard.
            *** *Processor* : traite les donn√©es re√ßues par le receiver. Il peut les filtrer, les agr√©ger, les transformer, etc., avant de les envoyer √† l'exporter.
            *** *Exporter* : envoie les donn√©es trait√©es par le processor vers un backend sp√©cifique (Jaeger, Prometheus, Azure Monitor, etc.). +
            L'exporter est sp√©cialis√© dans un type de backend particulier et conna√Æt les protocoles et les formats de donn√©es sp√©cifiques √† ce backend. +
            image:openTelemetry_02.jpg[]

    * *SDK* : Fournit une interface pour instrumenter l'application

    * *API* : D√©finit les concepts et les op√©rations communs

    * *OTLP* (OpenTelemetry Protocol) : Protocole de communication pour les donn√©es de t√©l√©m√©trie
        ** Ce protocole est en train de devenir un standard dans l'IT.

image:openTelemetry_03.jpg[]
image:openTelemetry_04.jpg[]

En parall√®le de ces composants, les *connecteurs* ("*connector*") d√©velopp√©s par d'autres √©diteurs sont des outils servant de *pont entre OpenTelemetry et un syst√®me tiers* (un outil de monitoring, une base de donn√©es, une plateforme cloud, etc.). +
Ces connecteurs permet soit : 

    * d'*importer des donn√©es* depuis ce syst√®me tiers dans OpenTelemetry
    * ou inversement, d'*exporter les donn√©es* collect√©es par OpenTelemetry dans ce syst√®me

Quelques exemples de connecteurs pour OpenTelemetry : 

    * *Connecteur vers des outils de monitoring* : Prometheus, Grafana, Jaeger

        ** Le connecteur pour Grafana permet d'envoyer les traces et les m√©triques OpenTelemetry vers Grafana pour cr√©er des tableaux de bord personnalis√©s et des visualisations riches.
    
    * *Connecteur vers des BDD* : Elasticsearch, TimescaleDB (une BDD time-series)

    * *Connecteurs vers des plateformes cloud* : Azure Monitor, AWS CloudWatch, Google Cloud Monitoring

        ** Le connecteur pour *Azure Monitor* permet d'exporter les donn√©es OpenTelemetry vers Azure Monitor pour b√©n√©ficier des fonctionnalit√©s d'observabilit√© de la plateforme Azure, telles que l'analyse de logs et la cr√©ation d'alertes.

.Export direct
[IMPORTANT]
====
Souvent le workflow OpenTelemetry impliquant un connecteur est le suivant : +
Application instrument√©e -> Collector OpenTelemetry -> Connecteur pour syst√®me tiers -> Syst√®me tiers (ex : Azure Monitor)

-> MAIS l'usage d'un collector n'est PAS obligatoire, il est possible d'envoyer directement les donn√©es de t√©l√©m√©trie depuis votre applications instrument√©e vers votre syst√®me tiers : c'est l'*export direct*.

Quand privil√©gier l'export direct ?

    * *Simplicit√©* : Si vous avez besoin d'une solution simple et rapide pour envoyer des donn√©es √† syst√®me tiers, l'export direct peut √™tre suffisant.
        ** A l'inverse, passer par un collector vous offre une plus grande flexibilit√© dans le traitement des donn√©es. Vous pouvez les filtrer, les agr√©ger, les transformer avant de les envoyer √† d'autres backends (comme Azure Monitor)
    * *Petits volumes de donn√©es* : Pour de petits volumes de donn√©es, l'overhead d'un collector peut ne pas √™tre justifi√©.
        ** A l'inverse, le collector peut g√©rer de grands volumes de donn√©es et s'adapter √† l'√©volution de votre infrastructure.

En r√©sum√©:

    * Export direct : Plus simple √† mettre en place, mais moins flexible.
    * Collector : Plus flexible, mais n√©cessite une configuration suppl√©mentaire.
====

.Diff√©rence entre un connector et l'exporter d'un collector
[NOTE]
====
Les 2 composants peuvent sembler √™tre identiques, ou avoir des finalit√©s identiques, mais : 

    * L'*exporter* est un composant sp√©cialis√© dans *l'envoi* de donn√©es vers un backend sp√©cifique (uniquement l'envoi)
    * Le *connector* peut lui g√©rer *aussi bien l'envoi que la r√©ception* de donn√©es

image:openTelemetry_01.jpg[]

Pour plus de d√©tails, voir https://opentelemetry.io/docs/collector/building/connector/
====

== Utilisation d'OpenTelemetry sur Azure (A CREUSER)

Plut√¥t que d'instrumenter directement le code de son application √† l'aide d'un SDK OpenTelemetry, il est recommand√© dans le cas d'Azure d'*utiliser un agent OpenTelemetry*.

Raison de pr√©f√©rer un agent pour Azure : 

    * Simplicit√© : L'agent est pr√©configur√© pour fonctionner avec Azure Monitor, pas besoin de g√©rer les d√©tails de la configuration.
    * Automatisation : L'agent collecte les donn√©es de mani√®re automatique, pas besoin de modifier son code.
    * Maintenance : Azure g√®re la mise √† jour et la maintenance de l'agent, vous n'avez pas √† vous en soucier.
    * Int√©gration : L'agent est √©troitement int√©gr√© avec Azure Monitor, la visualisation et l'analyse des donn√©es en sont am√©lior√©es

-> Pour plus d'informations, voir https://learn.microsoft.com/en-us/azure/azure-monitor/app/opentelemetry-enable?tabs=python





























